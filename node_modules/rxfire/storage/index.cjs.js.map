{"version":3,"file":"index.cjs.js","sources":["../../storage/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2018 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Observable, from } from 'rxjs';\nimport { debounceTime, map, shareReplay } from 'rxjs/operators';\nexport function fromTask(task) {\n    return new Observable(function (subscriber) {\n        var progress = function (snap) { return subscriber.next(snap); };\n        var error = function (e) { return subscriber.error(e); };\n        var complete = function () { return subscriber.complete(); };\n        // emit the current state of the task\n        progress(task.snapshot);\n        // emit progression of the task\n        var unsubscribeFromOnStateChanged = task.on('state_changed', progress);\n        // use the promise form of task, to get the last success snapshot\n        task.then(function (snapshot) {\n            progress(snapshot);\n            setTimeout(function () { return complete(); }, 0);\n        }, function (e) {\n            progress(task.snapshot);\n            setTimeout(function () { return error(e); }, 0);\n        });\n        // the unsubscribe method returns by storage isn't typed in the\n        // way rxjs expects, Function vs () => void, so wrap it\n        return function unsubscribe() {\n            unsubscribeFromOnStateChanged();\n        };\n    }).pipe(\n    // since we're emitting first the current snapshot and then progression\n    // it's possible that we could double fire synchronously; namely when in\n    // a terminal state (success, error, canceled). Debounce to address.\n    debounceTime(0));\n}\nexport function getDownloadURL(ref) {\n    return from(ref.getDownloadURL());\n}\n// TODO: fix storage typing in firebase, then apply the same fix here\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function getMetadata(ref) {\n    return from(ref.getMetadata());\n}\nexport function put(ref, data, metadata) {\n    return new Observable(function (subscriber) {\n        var task = ref.put(data, metadata);\n        return fromTask(task).subscribe(subscriber).add(task.cancel);\n    }).pipe(shareReplay({ bufferSize: 1, refCount: true }));\n}\nexport function putString(ref, data, format, metadata) {\n    return new Observable(function (subscriber) {\n        var task = ref.putString(data, format, metadata);\n        return fromTask(task).subscribe(subscriber).add(task.cancel);\n    }).pipe(shareReplay({ bufferSize: 1, refCount: true }));\n}\nexport function percentage(task) {\n    return fromTask(task).pipe(map(function (s) { return ({\n        progress: (s.bytesTransferred / s.totalBytes) * 100,\n        snapshot: s\n    }); }));\n}\n"],"names":["Observable","debounceTime","from","shareReplay","map"],"mappings":"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"}